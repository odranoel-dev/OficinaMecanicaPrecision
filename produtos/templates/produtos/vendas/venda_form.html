{% extends 'produtos/base.html' %} 

{% block content %}
<style>
    /* Estilo para o botÃ£o de venda */
    .btn-venda {
        background: linear-gradient(90deg, #28a745, #218838);
        color: white;
        font-weight: bold;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .btn-venda:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .form-venda {
        margin-bottom: 30px; 
        padding: 25px; 
        background: #fdfdfd; 
        border-radius: 12px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        border: 1px solid #eee;
    }
    .form-venda p {
        margin-bottom: 1.2rem;
    }
    .form-venda label {
        font-weight: 600;
        margin-bottom: 6px;
        display: block;
        color: #333;
    }
    .form-control, .form-select {
        border-radius: 8px;
        padding: 10px;
    }
</style>

<h2 style="text-align:center; margin-bottom:20px; color: #333;">ðŸ›’ Registrar Nova Venda</h2>

<!-- FormulÃ¡rio de Venda -->
<form method="post" class="form-venda">
    {% csrf_token %}
    
    <!-- 
      Exibe erros globais do formulÃ¡rio (ex: estoque insuficiente).
      Isto Ã© MUITO IMPORTANTE para o usuÃ¡rio saber o que deu errado.
    -->
    {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert" style="border-radius: 8px;">
            <strong>Erro:</strong>
            {% for error in form.non_field_errors %}
                {{ error }}
            {% endfor %}
        </div>
    {% endif %}

    <!-- Renderiza os campos do formulÃ¡rio (como <p>) -->
    {{ form.as_p }}
    
    <button type"submit" class="btn btn-venda">
        Finalizar Venda
    </button>
</form>

<!-- Tabela de Vendas Recentes -->
<h3 style="margin-top: 30px; border-bottom: 2px solid #eee; padding-bottom: 5px; color: #444;">Vendas Recentes</h3>
<table class="table table-striped table-hover" style="border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
    <thead style="background-color: #f0f2f5;">
        <tr>
            <th>Data</th>
            <th>Cliente</th>
            <th>Produto (PeÃ§a)</th>
            <th>Quantidade</th>
        </tr>
    </thead>
    <tbody>
        {% for venda in vendas_recentes %}
        <tr>
            <td>{{ venda.data_venda|date:"d/m/Y H:i" }}</td>
            <td>{{ venda.cliente.nome|default:"Consumidor Final" }}</td>
            <td>{{ venda.produto.peca }}</td>
            <td>{{ venda.quantidade }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4" style="text-align:center; font-style: italic; color: #777; padding: 20px;">
                Nenhuma venda registrada ainda.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}